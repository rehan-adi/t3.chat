generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                          String            @id @default(uuid())
  name                        String?
  email                       String            @unique
  credits                     Int               @default(5)
  profilePicture              String?           @map("profile_picture")
  isPremium                   Boolean           @default(false) @map("is_premium")
  isByokEnabled               Boolean           @default(false) @map("is_byok_enabled")
  isEmailVerified             Boolean           @default(false) @map("is_email_verified")
  isBillingPreferencesEnabled Boolean           @default(false) @map("is_billing_preferences_enabled")
  lastDailyReset              DateTime?         @map("last_daily_reset")
  lastMonthlyReset            DateTime?         @map("last_monthly_reset")
  activeProfileId             String?           @map("active_profile_id")
  activeProfile               Profile?          @relation("ActiveProfile", fields: [activeProfileId], references: [id])
  profiles                    Profile[]         @relation("UserProfiles")
  paymentHistory              Payment[]
  openRouterApiKey            OpenRouterApiKey?
  createdAt                   DateTime          @default(now()) @map("created_at")
  updatedAt                   DateTime          @updatedAt @map("updated_at")

  @@map("users")
}

model Profile {
  id                  String               @id @default(uuid())
  userId              String               @map("user_id")
  profileName         String               @map("profile_name")
  user                User                 @relation("UserProfiles", fields: [userId], references: [id], onDelete: Cascade)
  activeForUsers      User[]               @relation("ActiveProfile")
  isDefault           Boolean              @default(false)
  createdAt           DateTime             @default(now()) @map("created_at")
  updatedAt           DateTime             @updatedAt @map("updated_at")
  conversations       Conversation[]
  systemCustomization SystemCustomization?

  @@unique([userId, profileName])
  @@index([userId])
  @@map("profiles")
}

model Conversation {
  id              String    @id @default(uuid())
  title           String?
  summary         String?
  isPinned        Boolean   @default(false) @map("is_pinned")
  profileId       String    @map("profile_id")
  profile         Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  messages        Message[]
  expiresAt       DateTime? @map("expires_at")
  isTemporaryChat Boolean   @default(false) @map("is_temporary_chat")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  @@index([expiresAt])
  @@map("conversations")
}

model Message {
  id             String       @id @default(uuid())
  conversationId String       @map("conversation_id")
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  role           Role
  response       String
  modelName      String?      @map("model_name")
  createdAt      DateTime     @default(now()) @map("created_at")

  @@index([conversationId])
  @@map("messages")
}

model SystemCustomization {
  id           String   @id @default(uuid())
  systemBio    String?  @map("system_bio")
  systemName   String?  @map("system_name")
  systemPrompt String   @map("system_prompt")
  systemTrait  Trait[]
  profileId    String   @unique @map("profile_id")
  profile      Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("system_customizations")
}

model OpenRouterApiKey {
  id        String   @id @default(uuid())
  key       String
  userId    String   @unique @map("user_id")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("open_router_api_key")
}

model Payment {
  id                String    @id @default(uuid())
  orderId           String    @unique @map("order_id")
  paymentId         String?   @map("payment_id")
  paymentSessionId  String?   @map("payment_session_id")
  paymentEventTime  DateTime? @map("payment_event_time")
  amount            Int
  currency          String
  status            Status
  userId            String    @map("user_id")
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  rawWebhookPayload Json?     @map("raw_webhook_payload")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  @@index([userId])
  @@map("payments")
}

enum Role {
  user
  ai
}

enum Trait {
  friendly
  witty
  concise
  empathetic
  creative
  patient
  curious
}

enum Status {
  PENDING
  INIT_ORDER_FAILED
  SUCCESS
  FAILED
}
